<%- include('partials/header', { title: 'Crear Pregunta' }) %>
<%- include('partials/navbar') %>

<h1>Nueva pregunta</h1>

<form action="/preguntas/crear" method="POST">
  <input type="text" name="enunciado" placeholder="Enunciado" required>

  <div id="opciones-container">
    <h3>Opciones:</h3>

    <div class="opcion">
      <input type="text" name="opciones[]" placeholder="Opción 1" required>
    </div>

    <div class="opcion">
      <input type="text" name="opciones[]" placeholder="Opción 2" required>
    </div>
  </div>
  
  <button type="button" id="add-option">Añadir opción</button>

  <div>
    <label>Tema:</label>
    <div id="temas-container">
      <div class="tema-select">
        <select name="tema[]">
          <% temas.forEach(t => { %>
            <option value="<%= t %>"><%= t %></option>
          <% }) %>
        </select>
      </div>
    </div>
    <button type="button" id="add-tema">+ Añadir tema</button>

  </div>

  <div>
    <label>Respuesta Correcta:</label>
    <input type="text" name="respuestaCorrecta" placeholder="Respuesta correcta" required>
  </div>

  <button type="submit">Guardar</button>
</form>

<script>
  // Añadir nueva opción
  document.getElementById("add-option").addEventListener("click", () => {
    const cont = document.getElementById("opciones-container");
    const div = document.createElement("div");
    div.classList.add("opcion");
    div.innerHTML = `
      <input type="text" name="opciones[]" placeholder="Nueva opción" required>
      <button type="button" class="remove-option">X</button>
    `;
    cont.appendChild(div);
    div.querySelector(".remove-option").addEventListener("click", () => div.remove());
  });

  // Añadir nuevo selector de tema con opción de eliminar
  document.getElementById('add-tema').addEventListener('click', function() {
    const container = document.getElementById('temas-container');
    const selects = container.querySelectorAll('select');
    if (selects.length === 0) return; // seguridad

    // Clonamos el último select del contenedor
    const nuevoSelect = selects[selects.length - 1].cloneNode(true);
    nuevoSelect.selectedIndex = 0;

    // Añadirlo envuelto en div con botón de eliminar
    const wrapper = document.createElement('div');
    wrapper.className = 'tema-select-wrapper';
    wrapper.appendChild(nuevoSelect);

    // Crear botón "X" para eliminar
    const btnEliminar = document.createElement('button');
    btnEliminar.type = 'button';
    btnEliminar.textContent = 'X';
    btnEliminar.className = 'btn-eliminar-tema';
    btnEliminar.addEventListener('click', () => {
        container.removeChild(wrapper);
    });

    wrapper.appendChild(btnEliminar);
    container.appendChild(wrapper);
});

</script>
